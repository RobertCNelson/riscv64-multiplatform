From 7b9f907cfe7c2eaa6f09148f1dd3a04d62a1c30a Mon Sep 17 00:00:00 2001
From: Tom <support@vamrs.com>
Date: Mon, 19 Apr 2021 01:17:19 +0800
Subject: [PATCH 22/38] drivers/usb/cdns3/core: force set USB to HOST
 mode(VIC7100 DEBUG)

---
 drivers/usb/cdns3/core.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/usb/cdns3/core.c b/drivers/usb/cdns3/core.c
index 199713769289..9eb1fd406d73 100644
--- a/drivers/usb/cdns3/core.c
+++ b/drivers/usb/cdns3/core.c
@@ -18,6 +18,7 @@
 #include <linux/interrupt.h>
 #include <linux/io.h>
 #include <linux/pm_runtime.h>
+//#include <linux/gpio.h>
 
 #include "core.h"
 #include "host-export.h"
@@ -87,6 +88,13 @@ static int cdns_core_init_role(struct cdns *cdns)
 	int ret;
 
 	dr_mode = usb_get_dr_mode(dev);
+#ifdef CONFIG_SOC_STARFIVE_VIC7100
+	dr_mode = USB_DR_MODE_HOST;
+/*
+	if(gpio_get_value(22))
+		dr_mode = USB_DR_MODE_PERIPHERAL;
+*/
+#endif
 	cdns->role = USB_ROLE_NONE;
 
 	/*
-- 
2.30.0

